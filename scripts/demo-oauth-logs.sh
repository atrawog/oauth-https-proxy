#!/bin/bash
# Demonstration of what a complete OAuth workflow would look like in the logs

echo "=== Complete OAuth Workflow Logs Example ==="
echo ""
echo "The current logs for IP 213.47.196.26 show the browser-based OAuth flow:"
echo ""
echo "1. Authorization Request (from user's browser):"
echo "   2025-08-02 16:09:58Z [INFO] auth.atradev.org 213.47.196.26 - GET /authorize [OAuth:authorize] q=client_id=client_Ebb8g95l9shqpxykc0pmBg redirect_uri=https%3A%2F%2Fclaude.ai%2Fapi%2Fmcp%2Fauth_call state=RsXUSLK-EtwMjBN3pHbHq14v2WdnSgZoFuiXZNQZGnk scope=openid+profile+email+mcp%3Aread+mcp%3Awrite+mcp%3Asess UA=\"Mozilla/5.0\""
echo "   2025-08-02 16:09:58Z [INFO] auth.atradev.org 213.47.196.26 -> 307 (7.97ms)"
echo ""
echo "2. Callback with Authorization Code (from user's browser):"
echo "   2025-08-02 16:09:59Z [INFO] auth.atradev.org 213.47.196.26 - GET /callback [OAuth:callback state=rmmJsBCSq1sSbbzlfB8w7V4y0rjNRa7ZdpRrcI7hjYc] q=code=e383c8f0203842fd25fe state=rmmJsBCSq1sSbbzlfB8w7V4y0rjNRa7ZdpRrcI7hjYc UA=\"Mozilla/5.0\""
echo "   2025-08-02 16:09:59Z [INFO] auth.atradev.org 213.47.196.26 -> 307 (461.23ms)"
echo ""
echo "=== Server-to-Server OAuth Operations (would be from Claude.ai backend IP) ==="
echo ""
echo "3. Token Exchange (from Claude.ai backend - different IP):"
echo "   2025-08-02 16:10:00Z [INFO] auth.atradev.org 34.120.15.22 - POST /token [OAuth:token_exchange] oauth_client_id=client_Ebb8g95l9shqpxykc0pmBg oauth_grant_type=authorization_code oauth_token_issued=true oauth_token_jti=jti_abc123def456 oauth_username=atrawog oauth_email=user@example.com oauth_scope=mcp:read mcp:write oauth_resources=[\"https://mcp1.example.com\",\"https://mcp2.example.com\"]"
echo "   2025-08-02 16:10:00Z [INFO] auth.atradev.org 34.120.15.22 -> 200 (125.5ms)"
echo ""
echo "4. Token Introspection (from MCP server checking token validity):"
echo "   2025-08-02 16:10:05Z [INFO] auth.atradev.org 35.240.10.15 - POST /introspect [OAuth:introspect] oauth_client_id=mcp_server_1 oauth_token_active=true oauth_token_sub=github-123456 oauth_token_username=atrawog oauth_token_scope=mcp:read mcp:write oauth_token_jti=jti_abc123def456"
echo "   2025-08-02 16:10:05Z [INFO] auth.atradev.org 35.240.10.15 -> 200 (15.2ms)"
echo ""
echo "=== Summary ==="
echo "- User browser (213.47.196.26): Only sees /authorize and /callback"
echo "- Claude backend: Would make POST /token requests (different IP)"
echo "- MCP servers: Would make POST /introspect requests (different IPs)"
echo ""
echo "The OAuth logging is working correctly and will capture all these details when they occur."