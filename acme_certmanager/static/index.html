<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Proxy Manager</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>MCP Proxy Manager</h1>
            <div id="auth-status" class="auth-status"></div>
        </header>

        <main>
            <!-- Login Section -->
            <section id="login-section" class="section">
                <h2>Authentication</h2>
                <form id="login-form" class="form">
                    <div class="form-group">
                        <label for="token">Bearer Token:</label>
                        <input type="password" id="token" name="token" required 
                               placeholder="Enter your bearer token">
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </section>

            <!-- Dashboard Section (hidden by default) -->
            <section id="dashboard-section" class="section hidden">
                <div class="tabs">
                    <button class="tab-button active" data-tab="certificates">Certificates</button>
                    <button class="tab-button" data-tab="proxies">Proxies</button>
                    <button class="tab-button" data-tab="routes">Routes</button>
                    <button class="tab-button" data-tab="settings">Settings</button>
                </div>

                <!-- Certificates Tab -->
                <div id="certificates-tab" class="tab-content active">
                    <div class="tab-header">
                        <h2>Certificates</h2>
                        <button id="add-certificate-btn" class="btn btn-primary">Add Certificate</button>
                    </div>
                    
                    <!-- Certificate List -->
                    <div id="certificates-list" class="certificates-list">
                        <div class="loading">Loading certificates...</div>
                    </div>
                    
                    <!-- New Certificate Form (hidden by default) -->
                    <div id="new-certificate-form-container" class="form-container hidden">
                        <h3>Generate New Certificate</h3>
                        <form id="new-certificate-form" class="form">
                            <div class="form-group">
                                <label for="cert-name">Certificate Name:</label>
                                <input type="text" id="cert-name" name="cert_name" required 
                                       placeholder="e.g., production">
                            </div>
                            <div class="form-group">
                                <label for="domain">Domain:</label>
                                <input type="text" id="domain" name="domain" required 
                                       placeholder="e.g., example.com">
                            </div>
                            <div class="form-group">
                                <label for="acme-url">ACME Directory URL:</label>
                                <select id="acme-url" name="acme_directory_url">
                                    <option value="https://acme-v02.api.letsencrypt.org/directory">Let's Encrypt Production</option>
                                    <option value="https://acme-staging-v02.api.letsencrypt.org/directory">Let's Encrypt Staging</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Generate Certificate</button>
                                <button type="button" class="btn btn-secondary cancel-btn" onclick="toggleCertificateForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Proxies Tab -->
                <div id="proxies-tab" class="tab-content hidden">
                    <div class="tab-header">
                        <h2>Proxies</h2>
                        <button id="add-proxy-btn" class="btn btn-primary">Add Proxy</button>
                    </div>
                    
                    <!-- Proxy List -->
                    <div id="proxy-list" class="proxy-list">
                        <div class="loading">Loading proxy targets...</div>
                    </div>
                    
                    <!-- New Proxy Form (hidden by default) -->
                    <div id="new-proxy-form-container" class="form-container hidden">
                        <h3>Create Proxy Target</h3>
                        <form id="new-proxy-form" class="form">
                            <div class="form-group">
                                <label for="proxy-hostname">Hostname:</label>
                                <input type="text" id="proxy-hostname" name="hostname" required 
                                       placeholder="e.g., api.example.com">
                                <small>The domain that will be proxied</small>
                            </div>
                            <div class="form-group">
                                <label for="proxy-target">Target URL:</label>
                                <input type="url" id="proxy-target" name="target_url" required 
                                       placeholder="e.g., http://backend:8080">
                                <small>Where to forward requests</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="preserve-host" name="preserve_host_header" checked>
                                    Preserve Host Header
                                </label>
                                <small>Keep original hostname in forwarded requests</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enable-http" name="enable_http" checked>
                                    Enable HTTP
                                </label>
                                <small>Allow HTTP traffic on port 80</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enable-https" name="enable_https" checked>
                                    Enable HTTPS
                                </label>
                                <small>Allow HTTPS traffic on port 443 (requires certificate)</small>
                            </div>
                            <div class="form-group">
                                <label for="proxy-acme-url">Certificate Type:</label>
                                <select id="proxy-acme-url" name="acme_directory_url">
                                    <option value="https://acme-v02.api.letsencrypt.org/directory">Let's Encrypt Production</option>
                                    <option value="https://acme-staging-v02.api.letsencrypt.org/directory">Let's Encrypt Staging (Testing)</option>
                                </select>
                                <small>Staging certificates are for testing only and not trusted by browsers</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Create Proxy Target</button>
                                <button type="button" class="btn btn-secondary cancel-btn" onclick="toggleProxyForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Routes Tab -->
                <div id="routes-tab" class="tab-content hidden">
                    <div class="tab-header">
                        <h2>Routes</h2>
                        <button id="add-route-btn" class="btn btn-primary">Add Route</button>
                    </div>
                    
                    <!-- Route List -->
                    <div id="routes-list" class="routes-list">
                        <div class="loading">Loading routes...</div>
                    </div>
                    
                    <!-- New Route Form (hidden by default) -->
                    <div id="new-route-form-container" class="form-container hidden">
                        <h3>Add New Route</h3>
                        <form id="new-route-form" class="form">
                            <div class="form-group">
                                <label for="route-path">Path Pattern*:</label>
                                <input type="text" id="route-path" name="path_pattern" required 
                                       placeholder="/api/v1/">
                                <small>URL path prefix or regex pattern to match</small>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="route-target-type">Target Type*:</label>
                                    <select id="route-target-type" name="target_type" required>
                                        <option value="instance">Instance</option>
                                        <option value="port">Port</option>
                                        <option value="hostname">Hostname</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="route-target-value">Target Value*:</label>
                                    <input type="text" id="route-target-value" name="target_value" required 
                                           placeholder="localhost or 9000">
                                    <small>Instance name, port number, or hostname</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="route-priority">Priority:</label>
                                    <input type="number" id="route-priority" name="priority" 
                                           min="0" max="999" value="50">
                                    <small>Higher values are checked first</small>
                                </div>
                                <div class="form-group">
                                    <label for="route-methods">HTTP Methods:</label>
                                    <input type="text" id="route-methods" name="methods" 
                                           placeholder="GET,POST">
                                    <small>Comma-separated, leave empty for all</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="route-is-regex" name="is_regex">
                                    Path is a regular expression
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="route-description">Description:</label>
                                <input type="text" id="route-description" name="description" 
                                       placeholder="Optional description">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="route-enabled" name="enabled" checked>
                                    Route is enabled
                                </label>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Create Route</button>
                                <button type="button" class="btn btn-secondary" onclick="hideRouteForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settings-tab" class="tab-content hidden">
                    <h2>Settings</h2>
                    <div class="settings-section">
                        <h3>Certificate Email Configuration</h3>
                        <p class="info-text">Configure the default email address for Let's Encrypt certificate notifications. This email will be used for all certificates created with this token.</p>
                        
                        <form id="email-settings-form" class="form">
                            <div class="form-group">
                                <label for="cert-email">Certificate Email:</label>
                                <input type="email" id="cert-email" name="cert_email" 
                                       placeholder="admin@example.com">
                                <small>Leave empty to require email for each certificate</small>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Email</button>
                        </form>
                        
                        <div id="current-email" class="current-settings">
                            <strong>Current Email:</strong> <span id="current-email-value">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Token Information</h3>
                        <div class="token-info">
                            <p><strong>Token Name:</strong> <span id="token-name">Loading...</span></p>
                            <p><strong>Token Preview:</strong> <span id="token-preview">Loading...</span></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Certificate Details Modal -->
            <div id="cert-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>Certificate Details</h2>
                    <div id="cert-details"></div>
                </div>
            </div>

            <!-- Proxy Route Management Modal -->
            <div id="proxy-route-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close" onclick="closeProxyRouteModal()">&times;</span>
                    <h2>Route Configuration: <span id="proxy-route-hostname"></span></h2>
                    
                    <div class="route-mode-section">
                        <h3>Route Mode</h3>
                        <div class="form-group">
                            <label>
                                <input type="radio" name="route-mode" value="all" onchange="updateRouteMode()">
                                <strong>All</strong> - All routes apply except disabled ones
                            </label>
                            <label>
                                <input type="radio" name="route-mode" value="selective" onchange="updateRouteMode()">
                                <strong>Selective</strong> - Only enabled routes apply
                            </label>
                            <label>
                                <input type="radio" name="route-mode" value="none" onchange="updateRouteMode()">
                                <strong>None</strong> - No routes apply (hostname only)
                            </label>
                        </div>
                    </div>
                    
                    <div id="proxy-routes-list" class="proxy-routes-list">
                        <h3>Available Routes</h3>
                        <div class="loading">Loading routes...</div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="saveProxyRoutes()">Save Changes</button>
                        <button class="btn btn-secondary" onclick="closeProxyRouteModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <button id="logout-btn" class="btn btn-secondary hidden">Logout</button>
        </footer>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>